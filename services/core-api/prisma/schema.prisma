// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ---------- Store ----------
model Store {
  id        String  @id @default(cuid())
  storeCode String  @unique
  storeName String?

  locations Location[]
}

// ---------- Location ----------
model Location {
  id      String @id @default(cuid())
  storeId String
  code    String

  store       Store         @relation(fields: [storeId], references: [id])
  inventories Inventory[]
  txs         InventoryTx[]

  @@unique([storeId, code])
}

// ---------- Sku ----------
model Sku {
  id String @id @default(cuid())

  // 바코드(절대 기준). 초기 데이터 채우는 동안은 optional로 두고 나중에 required로 올려도 됨.
  makerCode String? @unique
  code      String?
  name      String?

  inventories Inventory[]
  txs         InventoryTx[]

  @@index([code])
}

// ---------- Inventory (스냅샷) ----------
model Inventory {
  id         String @id @default(cuid())
  skuId      String
  locationId String
  qty        Int

  sku      Sku      @relation(fields: [skuId], references: [id])
  location Location @relation(fields: [locationId], references: [id])

  @@unique([skuId, locationId])
}

// ---------- InventoryTx (변동 로그) ----------
// SQLite는 enum 미지원 → 문자열로 저장
model InventoryTx {
  id         String @id @default(cuid())
  skuId      String
  locationId String

  // 'INIT' | 'IN' | 'OUT' | 'MOVE' | 'ADJUST' 등
  type      String
  qty       Int
  reason    String?
  createdAt DateTime @default(now())

  sku      Sku      @relation(fields: [skuId], references: [id])
  location Location @relation(fields: [locationId], references: [id])

  @@index([skuId, locationId, createdAt])
}

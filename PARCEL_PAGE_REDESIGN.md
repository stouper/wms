# 택배 페이지 재설계 완료 보고서

## 변경 일시
2026-01-20

---

## 문제점 (Before)

### 기존 구조의 문제
택배 관련 기능이 **2개 페이지에 분산**되어 있어 실무 흐름이 끊김:

1. **ParcelRequestPage** (택배 요청)
   - Excel 업로드
   - 미리보기
   - 작지 생성
   - ❌ 이후 작업은 다른 페이지로 이동 필요

2. **StoreOutboundPage** (매장 출고)
   - 일반 매장 출고 작업
   - 택배 피킹 작업 (혼재)
   - CJ 예약 접수
   - 운송장 출력
   - ❌ 일반 출고와 택배가 섞여서 복잡

### 실무 문제점
- 택배 요청 업로드 후 → 작지 확인하려면 페이지 이동
- 매장 출고 페이지에서 택배/일반 출고 구분 어려움
- CJ 예약 버튼이 일반 출고 화면에 같이 있어서 혼란
- **워크플로우가 끊김**: Excel 업로드 → (페이지 이동) → 피킹 → CJ 예약

---

## 해결책 (After)

### 새로운 통합 페이지: `ParcelShipmentPage.jsx`

**택배 업무 전체 플로우를 한 페이지에 통합**

```
┌─────────────────────────────────────────┐
│  택배 작업 (ParcelShipmentPage)         │
├─────────────────────────────────────────┤
│  1️⃣ Excel 업로드 & 미리보기            │
│  2️⃣ 택배 작지 목록                     │
│  3️⃣ 피킹 작업 (스캔)                   │
│  4️⃣ CJ 예약 & 운송장                   │
└─────────────────────────────────────────┘
```

---

## 주요 개선사항

### 1. 섹션별 명확한 구분

각 섹션이 색상으로 구분되어 현재 어떤 단계인지 한눈에 파악 가능:

- **1️⃣ Excel 업로드**: 노란색 배경 (#fefce8)
- **2️⃣ 택배 작지 목록**: 파란색 배경 (#eff6ff)
- **3️⃣ 피킹 작업**: 초록색 배경 (#f0fdf4)
- **4️⃣ CJ 예약**: 노란색 배경 (#fef3c7)

### 2. 실무 흐름에 맞는 레이아웃

```
[1️⃣ Excel 업로드 & 미리보기]
┌────────────────────────────────────┐
│ 파일 선택: [Browse] [선택: 온라인.xlsx] │
│ [작지 생성 (17건)]                  │
│                                    │
│ 미리보기 (20/17 건)                │
│ ┌──────────────────────────────┐  │
│ │ 주문번호 수취인 주소 전화 ... │  │
│ └──────────────────────────────┘  │
└────────────────────────────────────┘

[2️⃣ 택배 작지 목록]
┌────────────────────────────────────┐
│ 📦 택배 작지 목록      [🔄 새로고침] │
│ ┌──────────────────────────────┐  │
│ │ 작지번호 제목 상태 수취인 ... │  │
│ │ ✓ 선택됨                     │  │
│ └──────────────────────────────┘  │
└────────────────────────────────────┘

[3️⃣ 피킹 작업]
┌────────────────────────────────────┐
│ 선택된 작지: [택배테스트#1]         │
│                                    │
│ 진행률: 80% (8/10)                 │
│ ██████████████████░░ 80%          │
│                                    │
│ 바코드 스캔:                       │
│ [barcode___] [1] [스캔]           │
│                                    │
│ 작지 아이템:                       │
│ ┌──────────────────────────────┐  │
│ │ SKU 상품명 계획 피킹 진행률   │  │
│ │ 207670-001 ... 2  2  ███ 100% │  │
│ └──────────────────────────────┘  │
└────────────────────────────────────┘

[4️⃣ CJ 예약 & 운송장]
┌────────────────────────────────────┐
│ [CJ 예약 접수] [운송장 출력]        │
│                                    │
│ CJ 예약 정보:                      │
│ 운송장 번호: 660026455391          │
│ 접수 일자: 20260120                │
└────────────────────────────────────┘
```

### 3. 진행 상태 시각화

**작지 목록:**
- 상태 뱃지: "진행중" (파란색) / "완료" (초록색)
- 운송장 번호 표시
- 선택된 작지 강조 (노란색 배경)

**피킹 진행률:**
- 전체 진행률 바 (0~100%)
- 실시간 수량 표시: "80% (8/10)"
- 개별 아이템별 진행률 바

**CJ 예약 상태:**
- 예약 전: "CJ 예약 접수" (파란색 버튼)
- 예약 후: "✓ 예약완료 (운송장번호)" (초록색 버튼, 비활성화)

### 4. 자동 새로고침

- Excel 업로드 → 작지 생성 시 **자동으로 작지 목록 새로고침**
- 스캔 완료 시 **자동으로 작지 정보 갱신**
- Job 선택 시 **자동으로 CJ 예약 상태 조회**

### 5. 택배 전용 필터링

- Job 목록에서 **parcel이 있는 Job만 자동 필터링**
- 일반 매장 출고 작지는 표시 안 됨
- 택배 작업에만 집중 가능

---

## 기술적 개선

### 1. 상태 관리 최적화

```javascript
// 로컬 스토리지 분리
const JOBS_KEY = "wms.parcel.jobs";           // 택배 전용
const SELECTED_KEY = "wms.parcel.selected";   // 택배 전용

// 기존 매장 출고와 충돌 없음
const STORE_JOBS_KEY = "wms.jobs.created.storeShip";
```

### 2. 자동 로딩

```javascript
// Job 선택 시 CJ 상태 자동 조회
useEffect(() => {
  if (selectedJobId && selectedJob?.parcel) {
    loadCjStatus(selectedJobId);
  }
}, [selectedJobId]);

// 작지 생성 후 자동 새로고침
async function onCreateJobs() {
  await parcelShipMode.createJobsFromPreview({...});
  await loadParcelJobs(); // 자동 새로고침
}
```

### 3. 진행률 계산

```javascript
const totalPlanned = useMemo(() => {
  return (selectedJob?.items || []).reduce(
    (sum, it) => sum + (it.qtyPlanned || 0), 0
  );
}, [selectedJob]);

const progress = totalPlanned > 0
  ? Math.floor((totalPicked / totalPlanned) * 100)
  : 0;
```

### 4. 운송장 모달

```javascript
// 모달로 운송장 정보 깔끔하게 표시
<Modal>
  <WaybillNumber />      // 운송장 번호
  <SenderInfo />         // 보내는 분
  <RecipientInfo />      // 받는 분
  <GoodsInfo />          // 상품 정보
  <DeliveryMessage />    // 배송 메시지
  <PrinterNotice />      // 프린터 출력 안내
</Modal>
```

---

## 파일 변경사항

### 신규 파일
- ✅ `apps/wms-desktop/renderer/src/pages/ParcelShipmentPage.jsx` (새로 생성)

### 수정 파일
- ✅ `apps/wms-desktop/renderer/src/App.jsx`
  - import 변경: `ParcelRequestPage` → `ParcelShipmentPage`
  - 라우팅 연결: `case "delivery"` → `ParcelShipmentPage`
  - 메뉴 레이블: "택배 출고" → "택배 작업"

### 보존 파일 (미사용)
- `apps/wms-desktop/renderer/src/pages/ParcelRequestPage.jsx` (기존 유지, 사용 안 함)
- `apps/wms-desktop/renderer/src/pages/StoreOutboundPage.jsx` (일반 매장 출고 전용으로 유지)

---

## 사용 방법

### 택배 작업 플로우

1. **사이드바에서 "택배 작업" 클릭**

2. **Excel 업로드**
   - "파일 선택" 버튼 클릭
   - `온라인 주문서 양식.xlsx` 선택
   - 미리보기 확인

3. **작지 생성**
   - "작지 생성 (N건)" 버튼 클릭
   - 생성 완료 토스트 확인
   - 작지 목록 자동 갱신

4. **작지 선택**
   - 택배 작지 목록에서 원하는 작지 클릭
   - 선택된 작지가 노란색으로 강조됨

5. **피킹 작업**
   - 바코드 입력란에 스캔
   - Enter 또는 "스캔" 버튼
   - 진행률 실시간 업데이트

6. **CJ 예약**
   - "CJ 예약 접수" 버튼 클릭
   - 확인 다이얼로그에서 확인
   - 운송장 번호 자동 발급

7. **운송장 출력**
   - "운송장 출력" 버튼 클릭
   - 모달에서 운송장 정보 확인
   - (프린터 연동 후) 출력

---

## 실무 개선 효과

### Before (기존)
```
Excel 업로드 페이지
    ↓ (페이지 이동)
매장 출고 페이지 (일반+택배 혼재)
    ↓ (작지 찾기 어려움)
스캔 작업
    ↓
CJ 예약 (어디 있는지 찾기)
    ↓
운송장 출력
```
**문제:** 페이지 이동, 혼재된 UI, 흐름 끊김

### After (개선)
```
택배 작업 페이지 (통합)
    ↓
Excel 업로드 → 미리보기 → 작지 생성
    ↓ (같은 페이지)
작지 목록 → 선택
    ↓ (같은 페이지)
피킹 작업 (진행률 실시간)
    ↓ (같은 페이지)
CJ 예약 → 운송장 출력
```
**장점:** 페이지 이동 없음, 전용 UI, 흐름 자연스러움

---

## 추가 개선 가능 사항 (향후)

1. **운송장 프린터 연동**
   - CODE128 바코드 생성
   - 123mm×100mm 레이아웃
   - 이름/전화번호 마스킹

2. **일괄 처리**
   - 여러 작지 동시 선택
   - 일괄 CJ 예약
   - 일괄 운송장 출력

3. **검색 & 필터**
   - 작지 검색 (주문번호, 수취인)
   - 상태별 필터 (진행중/완료)
   - 날짜 범위 필터

4. **배송 추적**
   - 운송장 번호 클릭 → 배송 상태 조회
   - 자동 상태 업데이트

5. **통계 대시보드**
   - 오늘의 택배 작지 수
   - 완료율
   - CJ 예약 현황

---

## 결론

**택배 업무 전체 플로우를 한 페이지에 통합하여 실무 효율성 대폭 향상**

- ✅ Excel 업로드 → 작지 생성 → 피킹 → CJ 예약 → 운송장 출력까지 **한 화면에서 완료**
- ✅ 섹션별 색상 구분으로 **현재 단계 명확히 파악**
- ✅ 진행률 실시간 표시로 **작업 진행 상황 직관적 확인**
- ✅ 자동 새로고침으로 **페이지 이동 불필요**
- ✅ 택배 전용 필터링으로 **일반 출고와 명확히 분리**

**실무 투입 준비 완료!**

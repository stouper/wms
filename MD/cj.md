# CJ대한통운 택배 API 테스트 환경 요약

> PDF 버전: V3.9.3
> 작성일: 2026-01-24

---

## 1. 기본 사항

| 항목 | 값 |
|------|------|
| 통신 규약 | REST |
| 인코딩 | UTF-8 |
| 헤더 | `CJ-Gateway-APIKey`, `Content-Type: application/json`, `Accept: application/json` |

---

## 2. 환경별 URL

| 환경 | Base URL |
|------|----------|
| **개발** | `https://dxapi-dev.cjlogistics.com:5054` |
| **운영** | `https://dxapi.cjlogistics.com:5052` |

---

## 3. 1Day Token

| 항목 | 내용 |
|------|------|
| 유효시간 | **24시간** |
| 주의사항 | 1초에 1회 이상 요청 시 차단됨 |
| 갱신 | 만료 30분 전 ~ 만료시간 사이에 재요청 시 토큰 갱신 |
| 재발급 시 | 유효시간 내 재요청 시 기존 토큰 재전달 (유효시간 동일) |

---

## 4. API 목록 (일반업체 기준)

| API | Endpoint | 설명 |
|-----|----------|------|
| 1Day 토큰 발행 | `/ReqOneDayToken` | 인증 토큰 발급 |
| 주소 정제 | `/ReqAddrRfnSm` | 주소 정제 + 권역 정보 |
| 운송장 번호 생성 | `/ReqInvcNo` | 단건 운송장 번호 채번 |
| 예약 접수 | `/RegBook` | 배송 예약 등록 |
| 예약 취소 | `/CnclBook` | 예약 취소 |

---

## 5. 예약 접수 API (RegBook)

### P.K 필드 (Primary Key)

| 필드 | 설명 |
|------|------|
| `CUST_ID` | 고객 ID |
| `RCPT_YMD` | 접수일자 (YYYYMMDD) |
| `CUST_USE_NO` | 고객사용번호 (내부 관리번호) |
| `RCPT_DV` | 접수구분 (01: 일반, 02: 반품) |
| `WORK_DV_CD` | 작업구분코드 (01: 일반) |
| `REQ_DV_CD` | 요청구분코드 (01: 요청, 02: 취소) |
| `MPCK_KEY` | 합포장 키 |

### 운송장 출력상태 (PRT_ST)

| 코드 | 설명 |
|------|------|
| `01` | 미출력 (CJ에서 출력) |
| `02` | 선출력 (고객사 자체 출력) |
| `03` | 선발번 (반품에는 없음) |

### 주요 필드

| 필드 | 설명 | 필수 |
|------|------|:----:|
| `TOKEN_NUM` | 1Day 토큰 | ✅ |
| `CAL_DV_CD` | 정산구분 (01: 계약운임) | ✅ |
| `FRT_DV_CD` | 운임구분 (01:선불, 02:착불, 03:신용) | ✅ |
| `CNTR_ITEM_CD` | 계약품목코드 (01: 일반) | ✅ |
| `BOX_TYPE_CD` | 박스타입 (01~07) | ✅ |
| `BOX_QTY` | 박스 수량 | ✅ |
| `CUST_MGMT_DLCM_CD` | 고객관리거래처코드 | ✅ |
| `INVC_NO` | 운송장 번호 (반품 시 빈칸) | - |

---

## 6. 예약 취소 API (CnclBook)

### 요청 방식

- `REQ_DV_CD: '02'` (취소)
- 나머지 필드는 **예약 접수 시와 동일한 데이터** 전송

### ⚠️ 취소 불가 조건 (중요!)

| # | 조건 | 이유 |
|---|------|------|
| 1 | **운송장 번호를 자체 생성하여 출력하는 고객사** | 오프라인 출고 상태 확인 불가 |
| 2 | **운송장 스캔이 있는 경우** | 택배기사가 상품 인수 간주 |
| 3 | **CJ에서 운송장 출력 후** | 출력 이후 취소 불가 |

> 📌 **우리 WMS 적용 시 주의**
> - 우리는 `ReqInvcNo`로 운송장 번호를 자체 생성 → `PRT_ST: '02'` (선출력)
> - **조건 1번에 해당하여 CnclBook API로 취소 불가**
> - 상품 미발송 시 택배운임에서 자동 제외됨

---

## 7. 박스 타입 코드

| 코드 | 영문 | 한글 | 규격 |
|:----:|:----:|:----:|------|
| 01 | A | 극소 | 80cm / 2kg 이하 |
| 02 | B | 소 | 100cm / 5kg 이하 |
| 03 | C | 중 | 120cm / 10kg 이하 |
| 04 | D1 | 대1 | 140cm / 15kg 이하 |
| 07 | D2 | 대2 | 160cm / 20kg 이하 |
| 05 | E | 이형 | 190cm / 25kg 이하 |
| 06 | F | 취급제한 | - |

---

## 8. 화물 상태 코드

| 코드 | 상태 |
|:----:|------|
| 01 | 집화지시 |
| 11 | 집화처리 |
| 12 | 미집화 |
| 41 | 간선상차 |
| 42 | 간선하차 |
| 82 | 배송출발 |
| 84 | 미배송 |
| 91 | 배송완료 |

---

## 9. 테스트 환경 특성

### 계약 이관

- 개발 API는 **개발 DB**와 연동 → 실제 계약 고객코드가 없을 수 있음
- 개발자 포털 → API 리스트 → 세부정보 → **계약이관** 메뉴에서 고객사번호 입력 후 이관

### 테스트 시 주의사항

1. `CUST_ID`와 `BIZ_REG_NUM` 매칭 확인 (청구 사업자번호)
2. 운송장 번호 생성 후 **당일 사용 원칙** (미사용 다수 발생 시 API 제약)
3. 예약 접수는 **단건** 호출 원칙

---

## 10. 공통 오류 코드

| HTTP | RESULT_CD | 설명 |
|:----:|:----:|------|
| 200 | S200 | 정상 |
| 400 | E400 | Bad Request (파라미터/요청문 오류) |
| 401 | E401 | 인증 실패 |
| 403 | E403 | 호출 권한 없음 |
| 404 | E404 | 검색 결과 없음 |
| 429 | E429 | 호출 한도 초과 |
| 500 | E500 | 서버 내부 에러 |

---

## 11. WMS 연동 현황

### 현재 구현된 API

| 기능 | 엔드포인트 | 상태 |
|------|----------|:----:|
| 토큰 발급 | `ReqOneDayToken` | ✅ |
| 운송장 채번 | `ReqInvcNo` | ✅ |
| 주소 정제 | `ReqAddrRfnSm` | ✅ |
| 예약 접수 | `RegBook` | ✅ |
| 예약 취소 | `CnclBook` | ⚠️ |

### 예약 취소 관련

- **현재 상태**: 우리 WMS는 운송장 자체 출력 방식 (`PRT_ST: '02'` - 선출력)
- **결론**: CJ API 정책상 **취소 API 사용 불가** (자체 출력 고객사는 오프라인 출고 상태 확인 불가)
- **대안**: 상품을 발송하지 않으면 택배운임에서 자동 제외됨

### 표준 API 적용 사항 (V3.9.3)

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 출력상태 | `PRT_ST: '01'` (미출력) | `PRT_ST: '02'` (선출력) |
| 배송메시지 | `DLV_MSG` | `REMARK_1` |
| 주소정제 | `CLNTNUM` 만 사용 | `CLNTMGMCUSTCD` 추가 |
| 배송추적 | `INVC_NO` 만 사용 | `CLNTNUM` 추가 |

---

## 12. 로컬 환경 설정

### WMS API (core-api)

| 항목 | 값 |
|------|------|
| Base URL | `http://localhost:3000` |
| 포트 | `3000` (env: PORT) |

### CJ API 엔드포인트 (WMS 내부)

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/exports/cj/reservation/:jobId` | CJ 예약 접수 (운송장 자동 발급) |
| GET | `/exports/cj/status/:jobId` | CJ 예약 상태 확인 |
| GET | `/exports/cj/waybill/:jobId` | 운송장 출력 데이터 조회 |
| POST | `/exports/cj/cancel/:jobId` | CJ 예약 취소 (⚠️ 정책상 불가) |

### 환경변수 (.env)

```
# CJ API 설정
CJ_API_BASE_URL=https://dxapi-dev.cjlogistics.com:5054
CJ_CUST_ID=30501859
CJ_BIZ_REG_NUM=1158700619

# 보내는 사람 정보
CJ_SENDER_NAME=에스카테스트
CJ_SENDER_TEL1=02
CJ_SENDER_TEL2=1234
CJ_SENDER_TEL3=5678
CJ_SENDER_ZIP=12345
CJ_SENDER_ADDR=서울시 강남구 테스트로 123
CJ_SENDER_DETAIL_ADDR=테스트빌딩 1층
```

---

## 13. 문의처

- 이메일: openapi@cjlogistics.com
- 계약 관련: 계약지사 담당자와 협의
